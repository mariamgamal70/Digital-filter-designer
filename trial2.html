<!DOCTYPE html>
<html>

<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
  <div id="signalGraph"></div>
  <div id="filteredGraph"></div>
  <input type="range" id="speedSlider" min="1" max="100" value="50" step="1">
  <span id="speedValue"></span> points per second
  <button id="stopButton">Stop</button>

  <script>
    var signalGraph = document.getElementById('signalGraph');
    var filteredGraph = document.getElementById('filteredGraph');
    var speedSlider = document.getElementById('speedSlider');
    var speedValue = document.getElementById('speedValue');
    var stopButton = document.getElementById('stopButton');

    var signalLength = 10000;
    var signal = generateSignal(signalLength); // Generate a lengthy signal
    var filteredSignal = new Array(signalLength);

    var currentIndex = 0;
    var filterSpeed = parseInt(speedSlider.value);
    var timerInterval = Math.floor(1000 / filterSpeed); // Calculate interval based on speed
    var timer;

    // Generate a random signal
    function generateSignal(length) {
      var signal = new Array(length);
      for (var i = 0; i < length; i++) {
        signal[i] = Math.random() * 2 - 1; // Generate random values between -1 and 1
      }
      return signal;
    }

    // Update the filtered signal
    function updateFilteredSignal() {
      var filterCoefficient = 0.5; // Example filter coefficient

      // Apply the difference equation to the current point
      if (currentIndex === 0) {
        filteredSignal[currentIndex] = signal[currentIndex];
      } else {
        filteredSignal[currentIndex] = signal[currentIndex] - filterCoefficient * signal[currentIndex - 1];
      }

      // Increment the current index
      currentIndex++;

      // Update the graph data
      var signalTrace = {
        x: Array.from({ length: currentIndex }, (_, i) => i),
        y: signal.slice(0, currentIndex),
        type: 'scatter',
        name: 'Signal'
      };

      var filteredTrace = {
        x: Array.from({ length: currentIndex }, (_, i) => i),
        y: filteredSignal.slice(0, currentIndex),
        type: 'scatter',
        name: 'Filtered Signal'
      };

      var layout = {
        title: 'Real-Time Filtering',
        xaxis: { title: 'Index' },
        yaxis: { title: 'Value' },
        showlegend: true
      };

      Plotly.newPlot(signalGraph, [signalTrace], layout);
      Plotly.newPlot(filteredGraph, [filteredTrace], layout);

      // Check if the filtering process is complete
      if (currentIndex >= signalLength) {
        clearInterval(timer);
        stopButton.disabled = true; // Disable the stop button
      }
    }

    // Update the filter speed value
    function updateSpeedValue() {
      speedValue.textContent = speedSlider.value;
      clearInterval(timer);
      filterSpeed = parseInt(speedSlider.value);
      timerInterval = Math.floor(1000 / filterSpeed);
      timer = setInterval(updateFilteredSignal, timerInterval);
    }

    // Stop the filtering process
    function stopFiltering() {
      clearInterval(timer);
      stopButton.disabled = true; // Disable the stop button
      var newSignal = generateSignal(signalLength);
      var newFilteredSignal = new Array(signalLength);
      currentIndex = 0;

      // Update the graph data with the new signal
      var signalTrace = {
        x: Array.from({ length: currentIndex }, (_, i) => i),
        y: newSignal.slice(0, currentIndex),
        type: 'scatter',
        name: 'Signal'
      };

      var filteredTrace = {
        x: Array.from({ length: currentIndex }, (_, i) => i),
        y: newFilteredSignal.slice(0, currentIndex),
        type: 'scatter',
        name: 'Filtered Signal'
      };

      var layout = {
        title: 'Real-Time Filtering',
        xaxis: { title: 'Index' },
        yaxis: { title: 'Value' },
        showlegend: true
      };

      Plotly.newPlot(signalGraph, [signalTrace], layout);
      Plotly.newPlot(filteredGraph, [filteredTrace], layout);
    }

    // Attach event listeners
    speedSlider.addEventListener('input', updateSpeedValue);
    stopButton.addEventListener('click', stopFiltering);

    // Initialize the graphs
    var signalTrace = {
      x: [],
      y: [],
      type: 'scatter',
      name: 'Signal'
    };

    var filteredTrace = {
      x: [],
      y: [],
      type: 'scatter',
      name: 'Filtered Signal'
    };

    var layout = {
      title: 'Real-Time Filtering',
      xaxis: { title: 'Index' },
      yaxis: { title: 'Value' },
      showlegend: true
    };

    Plotly.newPlot(signalGraph, [signalTrace], layout);
    Plotly.newPlot(filteredGraph, [filteredTrace], layout);

    // Start the filtering process
    timer = setInterval(updateFilteredSignal, timerInterval);
  </script>
</body>

</html>